"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[788],{1887:function(e,t,n){n.d(t,{Fx:function(){return h},QG:function(){return m},zk:function(){return p}});var r=n(678),o=n(8489),i=n(7133),s=n(2791),a=n(7760),l=n(5712),u=n(6253),c=n(184),m=["Remilia","Koishi","Suwako","Sakuya","Sanae","Meiling"],f=(0,s.memo)((function(e){var t=e.showBox,n=e.immune,r=e.dead;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("mesh",{visible:t,children:[(0,c.jsx)("boxGeometry",{args:[1.3,1.3,1.3]}),(0,c.jsx)("meshBasicMaterial",{color:"White"})]}),(0,c.jsxs)("mesh",{visible:!(r||!n),children:[(0,c.jsx)("sphereGeometry",{args:[1.5]}),(0,c.jsx)("meshBasicMaterial",{color:"#D87D68"})]}),(0,c.jsxs)("mesh",{visible:!!r,children:[(0,c.jsx)("boxGeometry",{args:[2.3,2.3,2.3]}),(0,c.jsx)("meshBasicMaterial",{map:(0,i.FN)()})]})]})})),d=function(e){switch(e.modelName){case"Remilia":return(0,c.jsx)(i.Fn,(0,o.Z)({},e));case"Koishi":return(0,c.jsx)(i.vg,(0,o.Z)({},e));case"Suwako":return(0,c.jsx)(i.cM,(0,o.Z)({},e));case"Sakuya":return(0,c.jsx)(i.kB,(0,o.Z)({},e));case"Sanae":return(0,c.jsx)(i.Gg,(0,o.Z)({},e));case"Meiling":return(0,c.jsx)(i.I3,(0,o.Z)({},e))}return(0,c.jsx)(i.Fn,(0,o.Z)({},e))},p=function(e){var t=(0,l.EJ)((function(){return{mass:0,type:"Kinematic",args:[1.3,1.3,1.3],collisionFilterMask:e.mask,collisionFilterGroup:e.group,onCollideBegin:e.onCollideBegin}})),n=(0,r.Z)(t,2),i=n[0],s=n[1],a=(0,u.a)().showBox;return void 0!==e.position&&s.position.set(e.position.x,e.position.y,e.position.z),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("group",{ref:i,children:(0,c.jsx)(f,{showBox:a,immune:e.immune,dead:e.dead})}),!0===e.dead?null:(0,c.jsx)(d,(0,o.Z)({},e))]})},h=function(e){var t=e.modelName,n=e.spin,o=e.scale,i=(0,s.useState)(new a.Euler(0,0,0)),l=(0,r.Z)(i,2),u=l[0],m=l[1];return(0,s.useEffect)((function(){if(n){var e=setInterval((function(){m((function(e){var t=(new a.Quaternion).setFromEuler(e),n=(new a.Quaternion).setFromAxisAngle(new a.Vector3(0,1,0),.1),r=t.multiply(n);return(new a.Euler).setFromQuaternion(r)}))}),60);return function(){clearInterval(e)}}}),[n]),(0,c.jsx)(p,{modelName:t,rotation:u,scale:o})}},4395:function(e,t,n){n.d(t,{k:function(){return m},q:function(){return f}});var r,o,i=n(7186),s=n(2360),a=n(9080),l=n(184),u=s.ZP.div(r||(r=(0,i.Z)(["\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  color: White;\n  font-weight: bold;\n  font-size: 25pt;\n  gap: 20px;\n\n  img {\n    width: 45px;\n    height: 45px;\n  }\n"]))),c=s.ZP.div(o||(o=(0,i.Z)(["\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  color: ",";\n  font-size: 18pt;\n  gap: 20px;\n\n  img {\n    width: 40px;\n    height: 40px;\n  }\n"])),(function(e){return e.dead?"red":"white"})),m=function(e){var t=e.src,n=e.name;return(0,l.jsx)("div",{className:"profile",children:(0,l.jsxs)(u,{children:[(0,l.jsx)("img",{src:t}),(0,l.jsx)("div",{children:n})]})})},f=function(e){var t=e.playerList;return(0,l.jsx)("div",{className:"profile",children:null===t||void 0===t?void 0:t.map((function(e,t){return(0,l.jsxs)(c,{dead:e.healthPoints<=0,children:[(0,l.jsx)("img",{src:e.picture}),(0,l.jsx)("div",{children:e.name}),(0,l.jsx)("div",{children:e.healthPoints<=0?"LOSE":"HP :"+e.healthPoints}),e.isLeader?(0,l.jsx)(a.Z,{}):null]},t)}))})}},8788:function(e,t,n){n.r(t),n.d(t,{default:function(){return J}});var r,o,i=n(678),s=n(7186),a=n(348),l=n(7133),u=n(4829),c=n(184),m=function(){return(0,u.z)().scene.background=(0,l.BY)(),null},f=function(){return(0,c.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-5,0],children:[(0,c.jsx)("circleGeometry",{attach:"geometry",args:[200]}),(0,c.jsx)("meshBasicMaterial",{attach:"material",map:(0,l.JA)()})]})},d=n(5712),p=n(1887),h=n(5673),x=n(7760),y=n(6253),v=n(1303),w=n(2791),g=n(2569),j=Math.PI/6,E=Math.PI/6,Z={KeyW:"pitch_up",KeyS:"pitch_down",KeyA:"yaw_left",KeyD:"yaw_right",KeyH:"shoot0",KeyJ:"shoot1",KeyK:"shoot2",KeyL:"shoot3",Space:"move_forward",ShiftLeft:"slow_down"},P={0:"move_forward"},S=function(){var e=(0,g.v)(Z),t=((0,g.i)(P),(0,w.useState)([0,0,0])),n=(0,i.Z)(t,2),r=n[0],o=n[1],s=(0,w.useState)([0,0,0]),a=(0,i.Z)(s,2),l=a[0],u=a[1],c=(0,w.useState)({modelPos:new x.Vector3(0,0,0),modelEuler:new x.Euler(0,0,0),cameraPos:new x.Vector3(0,0,3),cameraEuler:new x.Euler(0,0,0)}),m=(0,i.Z)(c,2),f=m[0],p=m[1],h=(0,w.useState)([]),y=(0,i.Z)(h,2),S=y[0],F=y[1],B=(0,d.Eo)((function(){return{mass:0,type:"Dynamic",position:[0,0,0]}})),k=(0,i.Z)(B,2),M=(k[0],k[1]);return(0,w.useEffect)((function(){var e=function(e,t,n){var r=e.position.subscribe((function(e){return t(e)})),o=e.rotation.subscribe((function(e){return n(e)}));return function(){r(),o()}}(M,o,u);return e}),[]),(0,w.useEffect)((function(){!function(e,t,n,r){var o=n.yaw_right,i=n.yaw_left,s=n.pitch_up,a=n.pitch_down,l=new x.Euler(t[0],t[1],t[2]),u=(new x.Quaternion).setFromEuler(l),c=(new x.Quaternion).setFromAxisAngle(new x.Vector3(0,1,0),j*(o?-1:i?1:0)),m=(new x.Quaternion).setFromAxisAngle(new x.Vector3(1,0,0),E*(s?1:a?-1:0)),f=u.multiply(c).multiply(m),d=(new x.Euler).setFromQuaternion(f),p=new x.Vector3(e[0],e[1],e[2]),h=new x.Vector3(0,0,5).applyEuler(l);r({modelEuler:d,cameraEuler:l,modelPos:p,cameraPos:(new x.Vector3).addVectors(p,h)})}(r,l,e,p)}),[r,l]),(0,w.useEffect)((function(){var t=[];e.shoot0?t.push("shoot0"):e.shoot1?t.push("shoot1"):e.shoot2?t.push("shoot2"):e.shoot3&&t.push("shoot3"),F(t)}),[e]),(0,w.useEffect)((function(){var t,n,r=function(e,t,n){var r=e.yaw_left,o=e.yaw_right,i=e.move_forward,s=e.slow_down?.6:1;return{lin_velocity:(new x.Vector3).set(0,0,i?-1:0).normalize().multiplyScalar(6*s).applyEuler(n.modelEuler),ang_velocity:(new x.Vector3).set(0,(r?1:0)-(o?1:0),0).normalize().multiplyScalar(1*s)}}(e,0,f);(t=M.velocity).set.apply(t,(0,v.Z)(r.lin_velocity)),(n=M.angularVelocity).set.apply(n,(0,v.Z)(r.ang_velocity))}),[e,f]),{rigidState:f,fireState:S}},F=[80,400,300,400],B=function(e,t,n){for(var r=[],o=Date.now(),i=0;i<n.length;i++){var s=parseInt(n[i].replace("shoot",""));(t||0===s)&&o-e[s]>F[s]&&(r.push(n[i]),e[s]=o)}return r},k=function(){var e=S(),t=e.rigidState,n=e.fireState,r=(0,h.L)().updatePlayer,o=(0,u.z)().camera,s=(0,y.a)(),a=s.modelName,l=s.roomID,m=s.playerID,f=s.isLeader,d=(0,w.useState)(4),x=(0,i.Z)(d,2),v=x[0],g=x[1],j=(0,w.useRef)(0),E=(0,w.useRef)([0,0,0,0]),Z=(0,w.useRef)(!1);o.position.copy(t.cameraPos),o.rotation.setFromVector3(t.cameraEuler);return(0,w.useEffect)((function(){Date.now()-j.current>80&&(r(l,m,{rigidState:t,fireState:v>0?B(E.current,f,n):[],healthPoints:v,immune:Z.current}),j.current=Date.now())}),[t,n,v]),(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(p.zk,{modelName:a,position:null===t||void 0===t?void 0:t.modelPos,rotation:null===t||void 0===t?void 0:t.modelEuler,scale:.1,mask:1,group:1,onCollideBegin:function(){Z.current||(g((function(e){return e-1})),Z.current=!0,setTimeout((function(){Z.current=!1}),3e3))},immune:Z.current,dead:v<=0})})},M=function(){var e=(0,h.L)().playerList,t=(0,y.a)().playerID;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(k,{}),null===e||void 0===e?void 0:e.map((function(e,n){return e.rigidState&&e.rigidState.modelPos&&e.rigidState.modelEuler?e.playerID===t?null:(0,c.jsx)(p.zk,{modelName:e.modelName,position:(new x.Vector3).copy(e.rigidState.modelPos),rotation:(new x.Euler).copy(e.rigidState.modelEuler),scale:.1,mask:0,group:0,onCollideBegin:function(){},immune:e.immune,dead:e.healthPoints<=0},t):null}))]})},V=n(2360),b=n(6710),I=n(7689),L=n(8489),D=n(3009),_=function(e,t){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)},K=(0,w.memo)((function(e){var t=(0,d.Eo)((function(){return{mass:0,position:[e.modelPos.x,e.modelPos.y,e.modelPos.z],velocity:(0,v.Z)(new x.Vector3(0,0,-14).applyEuler(e.modelEuler)),args:[.2],type:"Kinematic",collisionFilterGroup:e.group}})),n=(0,i.Z)(t,2),r=n[0];n[1];return(0,c.jsxs)("mesh",{ref:r,children:[(0,c.jsx)("sphereGeometry",{args:[.2]}),(0,c.jsx)("meshBasicMaterial",{map:(0,l.NU)()})]})})),A=(0,w.memo)((function(e){var t=(0,d.Eo)((function(){return{mass:0,position:[e.modelPos.x,e.modelPos.y,e.modelPos.z],velocity:(0,v.Z)(new x.Vector3(0,0,-8).applyEuler(e.modelEuler)),args:[.6],type:"Kinematic",collisionFilterGroup:e.group}})),n=(0,i.Z)(t,2),r=n[0];n[1];return(0,c.jsxs)("mesh",{ref:r,children:[(0,c.jsx)("sphereGeometry",{args:[.6]}),(0,c.jsx)("meshBasicMaterial",{map:(0,l.G3)()})]})})),G=(0,w.memo)((function(e){var t=(0,l.C3)(),n=_(15,5),r=(0,d.Eo)((function(){return{mass:0,position:[e.modelPos.x,e.modelPos.y,e.modelPos.z],velocity:(0,v.Z)(new x.Vector3(0,_(5,-5),-n).applyEuler(e.modelEuler)),args:[.2],type:"Kinematic",collisionFilterGroup:e.group}})),o=(0,i.Z)(r,2),s=o[0],a=o[1];return(0,w.useEffect)((function(){setTimeout((function(){var e;(e=a.velocity).set.apply(e,(0,v.Z)(new x.Vector3(0,0,0))),a.position.set(a.position)}),2e3)}),[]),(0,c.jsxs)("mesh",{ref:s,children:[(0,c.jsx)("sphereGeometry",{args:[.2]}),(0,c.jsx)("meshBasicMaterial",{map:t[_(t.length,0)],opacity:.5})]})})),z=(0,w.memo)((function(e){var t=(0,w.useState)(!1),n=(0,i.Z)(t,2),r=n[0],o=n[1],s=(0,w.useRef)(),a=(0,d.Eo)((function(){return{mass:0,position:[e.modelPos.x,e.modelPos.y,e.modelPos.z],velocity:(0,v.Z)(new x.Vector3(0,0,-10).applyEuler(e.modelEuler)),args:[.6],type:"Kinematic",collisionFilterGroup:e.group}})),u=(0,i.Z)(a,2),m=u[0],f=u[1];return(0,w.useEffect)((function(){var e=f.position.subscribe((function(e){return s.current=(0,D.Z)(x.Vector3,(0,v.Z)(e))}));return setTimeout((function(){f.velocity.set([0,0,0]),o(!0)}),2e3),function(){return e()}}),[]),r?(0,c.jsx)(N,(0,L.Z)((0,L.Z)({},e),{},{modelPos:s.current,BasicBullet:K})):(0,c.jsxs)("mesh",{ref:m,children:[(0,c.jsx)("sphereGeometry",{args:[.6]}),(0,c.jsx)("meshBasicMaterial",{map:(0,l.Fq)(),opacity:.5})]})})),Q=(0,w.memo)((function(e){for(var t=Math.PI/2,n=[],r=0;r<5;r++){var o=(new x.Quaternion).setFromAxisAngle(new x.Vector3(0,1,0),t/2-Math.random()*t),i=(new x.Quaternion).setFromEuler(e.modelEuler);i.multiply(o);var s=(new x.Euler).setFromQuaternion(i);n.push((0,L.Z)((0,L.Z)({},e),{},{key:r,modelEuler:s}))}return n.map((function(e){return(0,c.jsx)(G,(0,L.Z)({},e))}))})),N=(0,w.memo)((function(e){for(var t=[],n=e.BasicBullet,r=0;r<12;r++){var o=(new x.Quaternion).setFromAxisAngle(new x.Vector3(0,1,0),2*Math.PI/12*r),i=(new x.Quaternion).setFromEuler(e.modelEuler);i.multiply(o);var s=(new x.Euler).setFromQuaternion(i);t.push((0,L.Z)((0,L.Z)({},e),{},{key:r,modelEuler:s}))}return t.map((function(e){return(0,c.jsx)(n,(0,L.Z)({},e))}))})),R=(0,w.memo)((function(e){switch(e.type){case"shoot0":return(0,c.jsx)(K,(0,L.Z)({},e));case"shoot1":return(0,c.jsx)(N,(0,L.Z)((0,L.Z)({},e),{},{BasicBullet:A}));case"shoot2":return(0,c.jsx)(Q,(0,L.Z)({},e));case"shoot3":return(0,c.jsx)(z,(0,L.Z)({},e))}})),C=function(){var e=(0,w.useState)([]),t=(0,i.Z)(e,2),n=t[0],r=t[1],o=(0,h.L)().playerList,s=(0,y.a)().playerID,a=[5e3,5e3,12e3,5e3];return(0,w.useEffect)((function(){r((function(e){for(var t=e?(0,v.Z)(e):[],n=0;n<(null===o||void 0===o?void 0:o.length);n++){var r=o[n];if(!r.rigidState)return;if(!r.fireState)return;if(!r.rigidState.modelPos)return;if(!r.rigidState.modelEuler)return;for(var i=0;i<(null===(a=r.fireState)||void 0===a?void 0:a.length);i++){var a;t.push({type:r.fireState[i],key:Date.now(),group:r.playerID===s?0:1,modelPos:r.rigidState.modelPos,modelEuler:r.rigidState.modelEuler})}}return t}))}),[o]),(0,u.A)((function(){if(n){var e=n.filter((function(e){var t=e.type,n=e.key,r=parseInt(t.replace("shoot",""));return Date.now()-n<a[r]}));r(e||[])}})),null===n||void 0===n?void 0:n.map((function(e){return(0,c.jsx)(R,(0,L.Z)({},e))}))},O=n(4395),W=V.ZP.div(r||(r=(0,s.Z)(["\n  width: 1200px;\n  height: 675px;\n  position: relative;\n\n  .optionPanel {\n    position: absolute;\n    transform: translate(-50%, -50%);\n    top: 85%;\n    left: 78%;\n    width: 50%;\n    height: 50%;\n  }\n\n  .profile {\n    position: absolute;\n    top: 0%;\n    left: 0%;\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    align-items: flex-start;\n  }\n\n  .resultPanel {\n    position: absolute;\n    transform: translate(-50%, -50%);\n    top: 10%;\n    left: 50%;\n  }\n"]))),U=V.ZP.div(o||(o=(0,s.Z)(["\n  width: fit-content;\n  height: fit-content;\n  font-family: DFPOP\u30b3\u30f3 W12;\n  font-size: 60pt;\n  font-weight: bold;\n  color: #05fae7;\n"]))),q={ArrowUp:"up",ArrowDown:"down",ArrowRight:"right",ArrowLeft:"left",KeyZ:"select",KeyQ:"switch"},H=(0,w.memo)((function(){return(0,c.jsxs)(a.Xz,{children:[(0,c.jsx)(m,{}),(0,c.jsxs)(d.wI,{children:[(0,c.jsx)(f,{}),(0,c.jsx)(M,{}),(0,c.jsx)(C,{})]})]})})),J=function(){var e=(0,h.L)(),t=e.playerList,n=e.leaveRoom,r=(0,y.a)(),o=r.roomID,s=r.playerID,a=r.location,l=r.isLeader,u=r.showBox,m=r.setShowBox,f=r.setLocation,d=(0,I.s0)(),p=(0,w.useState)(0),x=(0,i.Z)(p,2),v=x[0],j=x[1],E=(0,w.useState)(!1),Z=(0,i.Z)(E,2),P=Z[0],S=Z[1],F=["Quit Game",u?"Hide Box":"Show Box"],B=(0,g.v)(q),k=(0,w.useState)(!1),M=(0,i.Z)(k,2),V=M[0],L=M[1],D=(0,w.useState)(!1),_=(0,i.Z)(D,2),K=_[0],A=_[1];return(0,w.useEffect)((function(){"game"===a?d("/game",{replace:!0}):"room"===a?d("/room",{replace:!0}):"home"===a&&d("/",{replace:!0})}),[a]),(0,w.useEffect)((function(){if(t){var e=t.filter((function(e){return e.isLeader}))[0],n=t.filter((function(e){return!e.isLeader}));if(!(n.length<=0)){var r=e.healthPoints<=0,o=!0;n.forEach((function(e){(e.healthPoints>0||void 0===e.healthPoints)&&(o=!1)})),l&&o&&!V?L(!0):l&&r&&!K?A(!0):l||!r||V?l||!o||K||A(!0):L(!0)}}}),[t]),(0,w.useEffect)((function(){if(B.switch&&S((function(e){return!e})),P){var e=v;if(B.up&&(e=v-1),B.down&&(e=v+1),e>=2&&(e=0),e<=-1&&(e+=2),j(e),B.select)switch(v){case 0:n(o,s),f("home");break;case 1:m((function(e){return!e}))}}}),[B]),(0,c.jsxs)(W,{children:[(0,c.jsx)(H,{}),P?(0,c.jsx)(b.a,{options:F,selection:v}):null,V||K?(0,c.jsx)(U,{className:"resultPanel",children:V?"YOU WIN":"YOU LOSE"}):null,(0,c.jsx)(O.q,{playerList:t})]})}}}]);
//# sourceMappingURL=788.4fdc0117.chunk.js.map